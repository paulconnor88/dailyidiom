<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Daily Idiom</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-QP92X8DDCN"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-QP92X8DDCN');
        
        // Custom event helper
        function trackEvent(eventName, params = {}) {
            gtag('event', eventName, params);
        }
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;800;900&family=DM+Sans:wght@400;500;600&family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --sky-blue: #5eb3d9;
            --sky-light: #7ec8e8;
            --coral: #ff6b4a;
            --coral-light: #ff8a70;
            --coral-dark: #e55a3a;
            --white: #FFFFFF;
            --cream: #fffbf7;
            --navy: #1e3a5f;
            --navy-light: #3a5a7f;
            --yellow: #fbbf24;
            --yellow-light: #fcd34d;
            --yellow-dark: #d9a520;
            --green: #22c55e;
            --green-light: #4ade80;
            --red: #EF4444;
            --text-secondary: #4a5568;
            --text-muted: #4a5568;
        }

        body {
            font-family: 'DM Sans', sans-serif;
            background: linear-gradient(180deg, var(--sky-light) 0%, var(--sky-blue) 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        /* Decorative pixels in background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle, rgba(255,255,255,0.3) 1px, transparent 1px),
                radial-gradient(circle, rgba(255,255,255,0.15) 1px, transparent 1px);
            background-size: 50px 50px, 30px 30px;
            background-position: 0 0, 15px 15px;
            pointer-events: none;
            z-index: 0;
        }

        .game-container {
            background: var(--cream);
            border-radius: 20px;
            padding: 20px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }

        /* NEW LOGO - Press Start 2P */
        .logo {
            font-family: 'Press Start 2P', cursive;
            text-align: center;
            margin-bottom: 12px;
        }

        .logo .daily {
            color: var(--navy);
            display: block;
            font-size: 22px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
            margin-bottom: 2px;
        }

        .logo .idiom {
            color: var(--coral);
            display: block;
            font-size: 22px;
            text-shadow: 2px 2px 0 rgba(0,0,0,0.1);
        }

        .logo-game-badge {
            display: inline-block;
            background: var(--yellow);
            color: var(--navy);
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            padding: 4px 10px;
            border-radius: 4px;
            margin-top: 6px;
            box-shadow: 0 3px 0 var(--yellow-dark);
        }

        .logo-tagline {
            font-family: 'Nunito', sans-serif;
            font-size: 13px;
            font-weight: 700;
            color: var(--text-muted);
            margin-top: 10px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .logo-sub {
            font-family: 'DM Sans', sans-serif;
            font-size: 12px;
            color: var(--text-muted);
            text-align: center;
            margin-top: 4px;
        }

        /* COMPLETION BANNER */
        .completion-banner {
            background: linear-gradient(135deg, #1a9f4a 0%, var(--green) 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 16px;
            text-align: center;
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 800;
            box-shadow: 0 3px 0 #147a3a;
            text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
        }

        /* VIDEO - Console style frame */
        .video-container {
            border-radius: 12px;
            margin-bottom: 8px;
            position: relative;
            overflow: hidden;
        }

        .video-inner {
            background: linear-gradient(135deg, #e8e8e8 0%, #f5f5f5 100%);
            border-radius: 12px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            border: 2px solid rgba(0,0,0,0.1);
        }

        .video-inner video,
        .video-inner img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }

        .video-caption {
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 16px;
            margin-top: 8px;
        }

        .video-caption strong {
            color: var(--navy);
            font-weight: 700;
        }

        /* DAY BADGE */
        .day-badge {
            display: inline-block;
            font-family: 'Press Start 2P', cursive;
            font-size: 7px;
            background: #e8f4f8;
            color: var(--navy);
            padding: 4px 8px;
            border-radius: 4px;
            margin-right: 6px;
        }

        /* STATS ROW - Trophies & XP */
        .stats-row-top {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 16px;
        }

        .stat-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 14px;
            border-radius: 8px;
            font-family: 'Press Start 2P', cursive;
            font-size: 10px;
            border: 3px solid;
            box-shadow: 0 3px 0;
        }

        .stat-pill.trophies {
            background: var(--cream);
            border-color: var(--yellow);
            box-shadow: 0 3px 0 var(--yellow-dark);
            color: var(--navy);
        }

        .stat-pill.xp {
            background: var(--coral);
            border-color: var(--coral-light);
            box-shadow: 0 3px 0 var(--coral-dark);
            color: white;
        }

        .stat-pill .icon {
            font-size: 14px;
        }

        /* BUTTONS - 3D style */
        .btn {
            font-family: 'Nunito', sans-serif;
            font-size: 15px;
            font-weight: 800;
            padding: 14px 20px;
            border: 3px solid;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.1s ease;
            width: 100%;
            margin-bottom: 10px;
            position: relative;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 !important;
        }

        .btn-primary {
            background: linear-gradient(180deg, var(--coral-light) 0%, var(--coral) 100%);
            border-color: var(--coral-dark);
            box-shadow: 0 4px 0 var(--coral-dark);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(180deg, var(--yellow-light) 0%, var(--yellow) 100%);
            border-color: var(--yellow-dark);
            box-shadow: 0 4px 0 var(--yellow-dark);
            color: var(--navy);
        }

        .btn-gold {
            background: linear-gradient(180deg, var(--yellow-light) 0%, var(--yellow) 100%);
            border-color: var(--yellow-dark);
            box-shadow: 0 4px 0 var(--yellow-dark);
            color: var(--navy);
        }

        .btn-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .btn-half {
            flex: 1;
            width: auto;
        }

        .btn-outline {
            background: linear-gradient(180deg, var(--green-light) 0%, var(--green) 100%);
            border: 3px solid #1a9f4a;
            box-shadow: 0 4px 0 #1a9f4a;
            color: var(--white);
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }

        .btn-outline:active {
            box-shadow: 0 1px 0 #1a9f4a;
        }

        /* Share link - game box style */
        .share-link {
            text-align: center;
            margin: 12px 0;
        }

        .share-link a {
            display: inline-block;
            color: var(--navy);
            font-weight: 800;
            font-size: 14px;
            text-decoration: none;
            background: var(--cream);
            padding: 12px 24px;
            border-radius: 10px;
            border: 3px solid var(--navy);
            box-shadow: 0 4px 0 var(--navy);
            transition: all 0.1s ease;
        }

        .share-link a:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 var(--navy);
        }

        .share-link a:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 var(--navy);
        }

        /* DIFFICULTY GRID */
        .difficulty-title {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            font-weight: 800;
            color: var(--navy);
            text-align: center;
            margin-bottom: 20px;
        }

        .difficulty-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .diff-btn {
            padding: 16px 8px;
            border: 3px solid var(--navy-light);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.1s ease;
            text-align: center;
            background: var(--cream);
            box-shadow: 0 4px 0 var(--navy);
        }

        .diff-btn:hover {
            transform: translateY(-2px);
            border-color: var(--coral);
        }

        .diff-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 var(--navy);
        }

        .diff-btn .stars {
            display: block;
            font-size: 18px;
            margin-bottom: 6px;
        }

        .diff-btn .xp-reward {
            font-family: 'Press Start 2P', cursive;
            font-size: 8px;
            color: var(--coral);
            display: block;
        }

        .diff-btn .diff-desc {
            font-family: 'DM Sans', sans-serif;
            font-size: 12px;
            color: var(--text-muted);
            display: block;
            margin-top: 6px;
        }

        /* MODE TITLE */
        .mode-title {
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: var(--text-muted);
            text-align: center;
            margin-bottom: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* WORD TILES */
        .word-area {
            background: var(--cream);
            border: 2px dashed rgba(0,0,0,0.1);
            border-radius: 16px;
            padding: 20px;
            min-height: 70px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            transition: border-color 0.2s ease;
        }

        .word-area:hover {
            border-color: var(--coral);
        }

        .word-tiles-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 24px;
        }

        .word-tile {
            background: var(--white);
            border: 2px solid rgba(0,0,0,0.08);
            border-radius: 12px;
            padding: 14px 20px;
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            font-weight: 800;
            color: var(--navy);
            cursor: pointer;
            transition: all 0.15s ease;
        }

        .word-tile:hover {
            background: var(--coral);
            border-color: var(--coral);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(255, 107, 74, 0.3);
        }

        .word-tile.selected {
            background: #e0e0e0;
            color: #999;
            cursor: default;
            border-color: #e0e0e0;
        }

        .word-tile.selected:hover {
            transform: none;
            box-shadow: none;
        }

        .word-tile.in-answer {
            background: var(--coral);
            border-color: var(--coral);
            color: white;
        }

        /* INPUT */
        .input-group {
            margin-bottom: 20px;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-muted);
            font-weight: 600;
            font-size: 14px;
        }

        .text-input {
            width: 100%;
            padding: 16px;
            border: 2px solid rgba(0,0,0,0.08);
            border-radius: 12px;
            font-size: 16px;
            font-family: 'DM Sans', sans-serif;
            transition: border-color 0.3s;
        }

        .text-input:focus {
            outline: none;
            border-color: var(--coral);
        }

        /* BLANKS */
        .fill-blanks {
            font-size: 18px;
            line-height: 2.2;
            text-align: center;
            margin-bottom: 20px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            color: var(--navy);
        }

        .blank-input {
            display: inline-block;
            border: none;
            border-bottom: 3px solid var(--coral);
            background: transparent;
            font-size: 18px;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            padding: 4px 8px;
            margin: 0 6px;
            width: 100px;
            text-align: center;
            color: var(--navy);
        }

        .blank-input:focus {
            outline: none;
            border-bottom-color: var(--coral-dark);
        }

        /* ANSWER REVEAL */
        .answer-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 24px;
            text-align: center;
            margin-bottom: 20px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .answer-title.correct {
            color: var(--green);
            text-shadow: 
                3px 3px 0 var(--navy),
                -1px -1px 0 var(--navy),
                1px -1px 0 var(--navy),
                -1px 1px 0 var(--navy);
        }

        .answer-title.incorrect {
            color: var(--coral);
            text-shadow: 
                3px 3px 0 var(--navy),
                -1px -1px 0 var(--navy),
                1px -1px 0 var(--navy),
                -1px 1px 0 var(--navy);
        }

        .idiom-display {
            font-family: 'Nunito', sans-serif;
            font-size: 20px;
            font-weight: 800;
            color: var(--navy);
            text-align: center;
            margin-bottom: 24px;
            padding: 20px;
            background: var(--cream);
            border-radius: 16px;
        }

        /* INFO TABS */
        .info-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            background: #f0e8e0;
            border-radius: 12px;
            padding: 6px;
        }

        .info-tab {
            flex: 1;
            padding: 12px;
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 800;
            text-align: center;
            background: transparent;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            color: var(--navy);
            transition: all 0.2s ease;
        }

        .info-tab.active {
            background: var(--navy);
            color: white;
            box-shadow: 0 2px 0 #0f1f33;
        }

        .info-tab:hover:not(.active) {
            background: rgba(255,255,255,0.5);
        }

        .info-content {
            background: var(--cream);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 100px;
        }

        .info-content p {
            font-size: 15px;
            color: var(--navy);
            line-height: 1.6;
        }

        .translate-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--coral);
            background: none;
            border: none;
            cursor: pointer;
            margin-top: 12px;
            font-weight: 700;
            font-family: 'Nunito', sans-serif;
        }

        .translate-btn:hover {
            text-decoration: underline;
        }

        /* ========== DELIGHT SCREEN ========== */
        .delight-screen {
            position: relative;
            min-height: 100%;
            overflow: hidden;
        }

        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 0.9;
            animation: confetti-fall linear infinite;
        }

        .confetti.square { border-radius: 2px; }
        .confetti.circle { border-radius: 50%; }
        .confetti.triangle {
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-bottom: 10px solid;
            background: transparent !important;
        }

        .confetti.c1 { background: #ff6b4a; }
        .confetti.c2 { background: #fbbf24; }
        .confetti.c3 { background: #22c55e; }
        .confetti.c4 { background: #5eb3d9; }
        .confetti.c5 { background: #ff69b4; }
        .confetti.c6 { background: #8b5cf6; }

        .confetti.triangle.c1 { border-bottom-color: #ff6b4a; }
        .confetti.triangle.c2 { border-bottom-color: #fbbf24; }
        .confetti.triangle.c3 { border-bottom-color: #22c55e; }
        .confetti.triangle.c4 { border-bottom-color: #5eb3d9; }
        .confetti.triangle.c5 { border-bottom-color: #ff69b4; }
        .confetti.triangle.c6 { border-bottom-color: #8b5cf6; }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(600px) rotate(720deg);
                opacity: 0.5;
            }
        }

        .confetti:nth-child(1) { left: 5%; animation-duration: 3s; animation-delay: 0s; }
        .confetti:nth-child(2) { left: 15%; animation-duration: 3.5s; animation-delay: 0.2s; }
        .confetti:nth-child(3) { left: 25%; animation-duration: 2.8s; animation-delay: 0.4s; }
        .confetti:nth-child(4) { left: 35%; animation-duration: 3.2s; animation-delay: 0.1s; }
        .confetti:nth-child(5) { left: 45%; animation-duration: 3.8s; animation-delay: 0.3s; }
        .confetti:nth-child(6) { left: 55%; animation-duration: 2.9s; animation-delay: 0.5s; }
        .confetti:nth-child(7) { left: 65%; animation-duration: 3.4s; animation-delay: 0.15s; }
        .confetti:nth-child(8) { left: 75%; animation-duration: 3.1s; animation-delay: 0.35s; }
        .confetti:nth-child(9) { left: 85%; animation-duration: 3.6s; animation-delay: 0.25s; }
        .confetti:nth-child(10) { left: 95%; animation-duration: 2.7s; animation-delay: 0.45s; }
        .confetti:nth-child(11) { left: 10%; animation-duration: 3.3s; animation-delay: 0.6s; }
        .confetti:nth-child(12) { left: 30%; animation-duration: 2.6s; animation-delay: 0.7s; }
        .confetti:nth-child(13) { left: 50%; animation-duration: 3.7s; animation-delay: 0.55s; }
        .confetti:nth-child(14) { left: 70%; animation-duration: 2.5s; animation-delay: 0.8s; }
        .confetti:nth-child(15) { left: 90%; animation-duration: 3.0s; animation-delay: 0.65s; }

        .delight-video-area {
            margin: 16px;
            border-radius: 12px;
            position: relative;
            z-index: 1;
            overflow: hidden;
        }

        .delight-video-inner {
            width: 100%;
            height: 200px;
            background: linear-gradient(180deg, #87ceeb 0%, #b8d4e8 60%, #e8d4b8 100%);
            border-radius: 12px;
            border: 2px solid rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .delight-video-inner video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .delight-emoji {
            font-size: 80px;
            animation: emoji-bounce 1s ease infinite;
        }

        @keyframes emoji-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .delight-title-area {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            padding: 24px 16px;
            position: relative;
            z-index: 1;
        }

        .delight-title {
            font-family: 'Press Start 2P', cursive;
            font-size: 22px;
            color: var(--green);
            text-align: center;
            line-height: 1.5;
            text-shadow: 
                4px 4px 0 var(--navy),
                -1px -1px 0 var(--navy),
                1px -1px 0 var(--navy),
                -1px 1px 0 var(--navy);
            animation: delight-pop 0.5s ease-out;
        }

        @keyframes delight-pop {
            0% { transform: scale(0.3) rotate(-5deg); opacity: 0; }
            60% { transform: scale(1.15) rotate(2deg); }
            80% { transform: scale(0.95) rotate(-1deg); }
            100% { transform: scale(1) rotate(0deg); opacity: 1; }
        }

        .title-stars {
            font-size: 32px;
            animation: star-spin 2s linear infinite;
        }

        @keyframes star-spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.2); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .delight-continue-btn {
            margin: 0 16px 16px;
            padding: 16px;
            background: linear-gradient(180deg, var(--coral-light) 0%, var(--coral) 100%);
            border: 3px solid var(--coral-dark);
            box-shadow: 0 4px 0 var(--coral-dark);
            border-radius: 12px;
            color: white;
            font-family: 'Nunito', sans-serif;
            font-size: 16px;
            font-weight: 800;
            text-align: center;
            cursor: pointer;
            position: relative;
            z-index: 1;
        }

        .delight-continue-btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 var(--coral-dark);
        }

        /* COMPLETE SCREEN */
        .celebration {
            font-size: 64px;
            text-align: center;
            margin-bottom: 12px;
        }

        .result-title {
            font-family: 'Bungee', cursive;
            font-size: 28px;
            text-align: center;
            margin-bottom: 24px;
            letter-spacing: -1px;
        }

        .result-title.correct {
            color: var(--green);
            text-shadow: 2px 2px 0 var(--navy);
        }

        .result-title.incorrect {
            color: var(--red);
            text-shadow: 2px 2px 0 var(--navy);
        }

        .stats-row {
            display: flex;
            justify-content: center;
            gap: 14px;
            margin-bottom: 24px;
        }

        .stat-box {
            background: var(--cream);
            border-radius: 16px;
            padding: 16px 20px;
            text-align: center;
            min-width: 85px;
            border: 2px solid rgba(0,0,0,0.05);
        }

        .stat-box .number {
            font-family: 'Nunito', sans-serif;
            font-size: 20px;
            color: var(--navy);
            font-weight: 900;
        }

        .stat-box .number.coral { color: var(--coral); }

        .stat-box .label {
            font-size: 10px;
            color: var(--text-muted);
            margin-top: 4px;
            text-transform: uppercase;
            font-weight: 700;
        }

        .answer-reminder {
            background: var(--navy);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .answer-reminder .idiom-text {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            font-weight: 800;
            color: var(--gold);
        }

        /* KO-FI */
        .kofi-banner {
            background: linear-gradient(135deg, #FF5E5B 0%, #D94343 100%);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
            margin-top: 16px;
        }

        .kofi-banner p {
            font-size: 13px;
            color: white;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .kofi-banner a {
            display: inline-block;
            background: white;
            color: #FF5E5B;
            font-family: 'Nunito', sans-serif;
            font-size: 13px;
            font-weight: 800;
            padding: 10px 20px;
            border-radius: 10px;
            text-decoration: none;
        }

        /* ARCHIVE */
        .archive-item {
            background: var(--cream);
            border-radius: 14px;
            padding: 16px 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }

        .archive-item:hover {
            transform: scale(1.01);
            border-color: var(--coral);
        }

        .archive-item.completed {
            border-left: 4px solid var(--green);
            background: rgba(34, 197, 94, 0.06);
        }

        .archive-item.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .archive-item.locked:hover {
            transform: none;
            border-color: transparent;
        }

        .archive-day {
            font-family: 'Nunito', sans-serif;
            font-size: 15px;
            color: var(--navy);
            font-weight: 800;
        }

        .archive-date {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 2px;
        }

        .archive-answer {
            font-size: 13px;
            color: var(--green);
            margin-top: 4px;
            font-weight: 600;
        }

        .archive-status {
            font-size: 20px;
        }

        /* BACK BUTTON */
        .back-btn {
            font-family: 'Nunito', sans-serif;
            font-size: 14px;
            font-weight: 700;
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0;
            transition: color 0.2s ease;
        }

        .back-btn:hover {
            color: var(--coral);
        }

        /* TOMORROW MESSAGE */
        .tomorrow-message {
            background: var(--cream);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .tomorrow-message h3 {
            font-family: 'Nunito', sans-serif;
            font-size: 18px;
            font-weight: 800;
            color: var(--navy);
            margin-bottom: 8px;
        }

        .tomorrow-message p {
            font-size: 14px;
            color: var(--text-muted);
        }

        /* FOOTER */
        .footer-legal {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            padding-top: 16px;
            border-top: 1px solid rgba(0,0,0,0.05);
        }

        .footer-legal a {
            font-size: 11px;
            color: var(--text-muted);
            text-decoration: none;
        }

        .footer-legal a:hover {
            color: var(--coral);
        }

        .footer-copyright {
            text-align: center;
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 8px;
        }

        /* TOAST */
        @keyframes slideIn {
            from { transform: translate(-50%, -100px); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translate(-50%, 0); opacity: 1; }
            to { transform: translate(-50%, -100px); opacity: 0; }
        }

        /* EMOJI PLACEHOLDER */
        .emoji-placeholder {
            font-size: 80px;
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- PASSWORD GATE -->
    <div id="gate" class="game-container" style="text-align: center;">
        <div class="logo">
            <span class="daily">DAILY</span>
            <span class="idiom">IDIOM</span>
            <div class="logo-game-badge">GAME</div>
        </div>
        
        
        <div style="margin: 30px 0;">
            <div style="font-size: 40px; margin-bottom: 12px;">üöÄ</div>
            <h2 style="font-family: 'Press Start 2P', cursive; font-size: 12px; color: var(--navy); margin-bottom: 8px;">COMING SOON!</h2>
            <p style="color: var(--text-muted); font-size: 14px;">Launching January 17th, 2026</p>
        </div>
        
        <div class="input-group">
            <input type="password" id="gatePassword" class="text-input" placeholder="Enter password" style="text-align: center;">
        </div>
        <button class="btn btn-primary" onclick="checkGate()">Enter</button>
        
        <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid rgba(0,0,0,0.05);">
            <p style="color: var(--text-muted); font-size: 13px;">Follow us for updates</p>
            <p style="color: var(--coral); font-weight: 700; font-size: 14px; margin-top: 8px;">@dailyidiomgame</p>
        </div>
    </div>
    
    <div id="app" class="game-container" style="display: none;"></div>

    <script>
        // PASSWORD GATE
        const GATE_PASSWORD = 'H0m3r15mym8';
        
        function checkGate() {
            const input = document.getElementById('gatePassword').value;
            if (input === GATE_PASSWORD) {
                document.getElementById('gate').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                sessionStorage.setItem('gateUnlocked', 'true');
            } else {
                document.getElementById('gatePassword').style.borderColor = '#EF4444';
                document.getElementById('gatePassword').value = '';
                document.getElementById('gatePassword').placeholder = 'Try again...';
            }
        }
        
        // Check if already unlocked this session
        if (sessionStorage.getItem('gateUnlocked') === 'true') {
            document.getElementById('gate').style.display = 'none';
            document.getElementById('app').style.display = 'block';
        }
        
        // Allow Enter key
        document.getElementById('gatePassword').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') checkGate();
        });
    
        // ==========================================
        // CONFIGURATION
        // ==========================================
        
        // Launch date: Jan 1, 2026 (TEMP FOR TESTING - change back to Jan 17 before launch)
        const LAUNCH_DATE = new Date('2026-01-01T00:00:00Z');
        
        // XP values per difficulty
        const XP_VALUES = { easy: 10, medium: 50, hard: 100 };
        
        function getDaysSinceLaunch() {
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const launchDate = new Date(LAUNCH_DATE);
            launchDate.setHours(0, 0, 0, 0);
            const diffTime = today - launchDate;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(0, diffDays) + 1;  // Day 1 = launch day
        }
        
        function getTodaysDate() {
            const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
            return new Date().toLocaleDateString('en-GB', options);
        }
        
        function getDateForDay(dayNumber) {
            const date = new Date(LAUNCH_DATE);
            date.setDate(date.getDate() + dayNumber - 1);
            const options = { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' };
            return date.toLocaleDateString('en-GB', options);
        }

        // ==========================================
        // GAME STATE
        // ==========================================
        
        let state = {
            screen: 'landing',
            difficulty: null,
            selectedWords: [],
            usedWordIndices: [],
            shuffledWords: null,
            userAnswer: '',
            blank1: '',
            blank2: '',
            blank3: '',
            isCorrect: false,
            trophies: parseInt(localStorage.getItem('idiomTrophies') || '0'),
            totalXP: parseInt(localStorage.getItem('idiomTotalXP') || '0'),
            hasPlayedToday: localStorage.getItem('lastPlayedDay') === getDayOfYear().toString(),
            activeTab: 'meaning',
            selectedLanguage: 'es',
            translatedContent: null,
            isPlayingArchive: false,
            archiveIdiomIndex: null,
            isFirstAttempt: true,
            showDelight: false
        };
        
        // Delight screen content (10-day rotation)
        const delightScreens = [
            { video: 'delight_videos/penguin_dive.mp4', title: "FLIPPIN'<br>AWESOME!", emoji: 'üêß' },
            { video: 'delight_videos/golf_putt.mp4', title: "HOLE IN<br>ONE!", emoji: '‚õ≥' },
            { video: 'delight_videos/dart_bullseye.mp4', title: "BULLSEYE!", emoji: 'üéØ' },
            { video: 'delight_videos/shooting_star.mp4', title: "YOU'RE<br>A STAR!", emoji: 'üå†' },
            { video: 'delight_videos/slam_dunk.mp4', title: "NOTHING<br>BUT NET!", emoji: 'üèÄ' },
            { video: 'delight_videos/rock_concert_crowd.mp4', title: "YOU ROCK!", emoji: 'üé∏' },
            { video: 'delight_videos/chefs_kiss.mp4', title: "PERFECTO!", emoji: 'üë®‚Äçüç≥' },
            { video: 'delight_videos/dog_frisbee.mp4', title: "NICE<br>CATCH!", emoji: 'üêï' },
            { video: 'delight_videos/thunderous_high_five.mp4', title: "HIGH<br>FIVE!", emoji: 'üôå' },
            { video: 'delight_videos/thumbs_up.mp4', title: "NAILED IT!", emoji: 'üëç' }
        ];
        
        function getDelightScreen(dayNumber) {
            const index = (dayNumber - 1) % 10;
            return delightScreens[index];
        }
        
        // Preload today's delight video for faster display
        function preloadDelightVideo() {
            const delight = getDelightScreen(getDisplayDayNumber());
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'video';
            link.href = delight.video;
            document.head.appendChild(link);
        }

        function getDayOfYear() {
            const now = new Date();
            const start = new Date(now.getFullYear(), 0, 0);
            const diff = now - start;
            const oneDay = 1000 * 60 * 60 * 24;
            return Math.floor(diff / oneDay);
        }

        function saveProgress() {
            localStorage.setItem('idiomTrophies', state.trophies.toString());
            localStorage.setItem('idiomTotalXP', state.totalXP.toString());
            localStorage.setItem('lastPlayedDay', getDayOfYear().toString());
        }

        function markTodayComplete() {
            localStorage.setItem('lastPlayedDay', getDayOfYear().toString());
            state.hasPlayedToday = true;
        }

        // Get total available idioms count
        function getTotalIdioms() {
            return 12; // Update this as you add more
        }

        // ==========================================
        // IDIOM LIBRARY
        // ==========================================
        
        const idiomLibrary = [
            // Day 1: Break the ice
            {
                text: "break the ice",
                meaning: "To do or say something that makes people feel more comfortable in a social situation, especially when meeting for the first time.",
                etymology: "This phrase comes from the 16th century, when ships would literally break ice to clear a path for other vessels. It soon became a metaphor for clearing the way in social situations - making that first move to start a conversation.",
                examples: ["She told a joke to break the ice at the meeting.", "Playing a game helped us break the ice on the first day of class.", "Let's play an ice-breaker before we get started."],
                words: ["break", "the", "ice"],
                blanks: {answers: ["break", "ice"]},
                emoji: "üßä",
                image: "idiom_images_pixel/idiom_01_break_the_ice_sora.mp4",
                hardModeAccepts: ["break the ice", "break ice", "breaking the ice", "broke the ice", "ice breaker", "icebreaker", "ice-breaker", "an ice-breaker"],
                boldVariations: ["break the ice", "ice-breaker"]
            },
            // Day 2: Piece of cake
            {
                text: "piece of cake",
                meaning: "Something that is very easy to do.",
                etymology: "This dates to the 1930s when the British Royal Air Force would describe an easy flying mission as being \"a piece of cake\" - as sweet and effortless as eating a slice of cake.",
                examples: ["The test was a piece of cake.", "Don't worry, fixing this problem will be a piece of cake.", "Once you've learned it, it becomes a piece of cake."],
                words: ["piece", "of", "cake"],
                blanks: {answers: ["piece", "cake"]},
                emoji: "üç∞",
                image: "idiom_images_pixel/idiom_03_piece_of_cake_sora.mp4",
                hardModeAccepts: ["piece of cake", "piece a cake", "peice of cake", "a piece of cake"]
            },
            // Day 3: Raining cats and dogs
            {
                text: "raining cats and dogs",
                meaning: "Raining very heavily.",
                etymology: "One popular theory suggests that in 17th century England, heavy rain would wash stray animals through the streets. Another links it to Norse mythology, where cats symbolised rain and dogs represented wind. Whatever its true origin, the phrase has meant heavy rain since the 1700s.",
                examples: ["It's raining cats and dogs, so we should stay inside.", "Yesterday it rained cats and dogs all afternoon.", "Don't forget your umbrella ‚Äî it's raining cats and dogs out there."],
                words: ["raining", "cats", "and", "dogs"],
                blanks: {answers: ["cats", "dogs"]},
                emoji: "üåßÔ∏è",
                image: "idiom_images_pixel/idiom_07_raining_cats_and_dogs_sora.mp4",
                hardModeAccepts: ["raining cats and dogs", "its raining cats and dogs", "it's raining cats and dogs", "rain cats and dogs", "rains cats and dogs", "to rain cats and dogs"],
                boldVariations: ["raining cats and dogs", "rained cats and dogs"]
            },
            // Day 4: Kick the bucket
            {
                text: "kick the bucket",
                meaning: "To die.",
                etymology: "The most accepted theory links this to animal slaughter. A wooden beam called a \"bucket\" (from Old French 'buquet') was used to hang animals, and their death throes involved kicking against it. The phrase has meant 'to die' since the 18th century.",
                examples: ["When I kick the bucket, I want to be remembered for my kindness.", "He joked that he'd learn to dance before he kicked the bucket.", "She said her grandfather kicked the bucket peacefully in his sleep."],
                words: ["kick", "the", "bucket"],
                blanks: {answers: ["kick", "bucket"]},
                emoji: "ü™£",
                image: "idiom_images_pixel/idiom_10_kick_the_bucket_sora.mp4",
                hardModeAccepts: ["kick the bucket", "kick bucket", "kicked the bucket", "kicking the bucket", "kicks the bucket", "to kick the bucket"],
                boldVariations: ["kick the bucket", "kicked the bucket"]
            },
            // Day 5: Burning bridges
            {
                text: "burning bridges",
                meaning: "To destroy relationships or opportunities, making it impossible to return to a previous situation.",
                etymology: "The phrase comes from military strategy, where armies destroyed bridges after crossing them to prevent retreat or enemy pursuit. It has been used metaphorically since the 19th century to describe irreversible personal or professional actions.",
                examples: ["She burned those bridges a long time ago.", "Don't burn bridges ‚Äî you might need those connections later.", "He's careful not to burn any bridges at work."],
                words: ["burning", "bridges"],
                blanks: {answers: ["burning", "bridges"]},
                emoji: "üî•",
                image: "idiom_images_pixel/idiom_15_burning_bridges_sora_v2.mp4",
                hardModeAccepts: ["burning bridges", "burn bridges", "burned bridges", "burns bridges", "burning your bridges", "burn your bridges"],
                boldVariations: ["burning bridges", "burned those bridges", "burn bridges", "burn any bridges"]
            },
            // Day 6: Spill the beans
            {
                text: "spill the beans",
                meaning: "To reveal secret information, either accidentally or deliberately.",
                etymology: "One popular theory links this to ancient Greece, where people voted by placing beans in jars - white for yes, black for no. If someone knocked over the jar, the beans would spill and reveal the secret vote! The phrase first appeared in American English around 1919.",
                examples: ["Come on, spill the beans! What happened?", "She finally spilled the beans about her promotion.", "He promised not to spill the beans about the surprise party."],
                words: ["spill", "the", "beans"],
                blanks: {answers: ["spill", "beans"]},
                emoji: "ü´ò",
                image: "idiom_images_pixel/idiom_02_spill_the_beans_sora_v2.mp4",
                hardModeAccepts: ["spill the beans", "spill beans", "spilling the beans", "spilled the beans", "spilt the beans", "to spill the beans"],
                boldVariations: ["spill the beans", "spilled the beans"]
            },
            // Day 7: Under the weather
            {
                text: "under the weather",
                meaning: "Feeling ill or unwell.",
                etymology: "This expression comes from maritime language. When sailors felt sick, they would go below deck to escape bad weather and rough seas. Being \"under the weather\" came to mean feeling unwell. The phrase appears in this sense from the early 19th century.",
                examples: ["I'm feeling a bit under the weather today.", "He was under the weather, so he stayed home from work.", "She looked under the weather yesterday."],
                words: ["under", "the", "weather"],
                blanks: {answers: ["under", "weather"]},
                emoji: "‚òÅÔ∏è",
                image: "idiom_images_pixel/idiom_09_under_the_weather_sora.mp4",
                hardModeAccepts: ["under the weather", "under weather", "feeling under the weather"]
            },
            // Day 8: Hit the nail on the head
            {
                text: "hit the nail on the head",
                meaning: "To be exactly right about the cause of a situation or problem.",
                etymology: "This phrase dates back to at least the 1500s. It comes from carpentry: hitting a nail squarely on the head drives it in properly, while missing causes damage. The expression quickly became a metaphor for precision and accuracy.",
                examples: ["You've hit the nail on the head ‚Äî that's exactly the problem.", "Her comment really hit the nail on the head.", "I think he's finally hitting the nail on the head with this new idea."],
                words: ["hit", "the", "nail", "on", "the", "head"],
                blanks: {answers: ["nail", "head"]},
                emoji: "üî®",
                image: "idiom_images_pixel/idiom_05_hit_the_nail_on_the_head_sora_v2.mp4",
                hardModeAccepts: ["hit the nail on the head", "hit nail on head", "hit the nail on head", "hitting the nail on the head", "hits the nail on the head"],
                boldVariations: ["hit the nail on the head", "hitting the nail on the head"]
            },
            // Day 9: Barking up the wrong tree
            {
                text: "barking up the wrong tree",
                meaning: "To be wrong about the reason for something or to pursue a mistaken course of action.",
                etymology: "This American idiom dates to the early 19th century. It comes from hunting, where dogs sometimes barked at the wrong tree after prey had escaped elsewhere.",
                examples: ["If you think I broke it, you're barking up the wrong tree.", "The police were barking up the wrong tree with their latest suspect.", "He's barking up the wrong tree if he thinks she's to blame."],
                words: ["barking", "up", "the", "wrong", "tree"],
                blanks: {answers: ["barking", "tree"]},
                emoji: "üêï",
                image: "idiom_images_pixel/idiom_11_barking_up_the_wrong_tree_sora.mp4",
                hardModeAccepts: ["barking up the wrong tree", "barking up wrong tree", "bark up the wrong tree", "barked up the wrong tree", "to bark up the wrong tree", "you're barking up the wrong tree", "youre barking up the wrong tree"]
            },
            // Day 10: Let the cat out of the bag
            {
                text: "let the cat out of the bag",
                meaning: "To reveal a secret, usually by accident.",
                etymology: "The phrase likely dates from the 18th century. One widely cited explanation links it to market fraud, where dishonest sellers would substitute a cat for a piglet in a bag. Opening the bag exposed the deception, revealing the secret.",
                examples: ["He let the cat out of the bag about the surprise party.", "She accidentally let the cat out of the bag at dinner.", "Try not to let the cat out of the bag before Friday."],
                words: ["let", "the", "cat", "out", "of", "the", "bag"],
                blanks: {answers: ["cat", "bag"]},
                emoji: "üê±",
                image: "idiom_images_pixel/let_the_cat_out_of_the_bag.mp4",
                hardModeAccepts: ["let the cat out of the bag", "let cat out of bag", "let the cat out the bag", "letting the cat out of the bag", "lets the cat out of the bag", "the cat's out of the bag", "the cats out of the bag", "cats out of the bag", "cat's out of the bag", "cat out of the bag", "to let the cat out of the bag"]
            },
            // Day 11: Kill two birds with one stone
            {
                text: "kill two birds with one stone",
                meaning: "To achieve two goals with a single action.",
                etymology: "One popular theory links this to Greek mythology. When Daedalus was imprisoned with his son Icarus, he threw stones at birds overhead to collect feathers for building wings to escape. With practice, he learned to strike one bird and hit a second with the ricochet - killing two birds with one stone!",
                examples: ["Studying on the train helps me kill two birds with one stone.", "He called his friend while driving home to kill two birds with one stone.", "She tidied her room and found her necklace ‚Äî two birds with one stone."],
                words: ["kill", "two", "birds", "with", "one", "stone"],
                blanks: {answers: ["two", "birds", "stone"]},
                emoji: "ü™®",
                image: "idiom_images_pixel/idiom_12_kill_two_birds_with_one_stone_sora.mp4",
                hardModeAccepts: ["kill two birds with one stone", "kill 2 birds with one stone", "kill two birds with 1 stone", "kill 2 birds with 1 stone", "killing two birds with one stone", "kills two birds with one stone", "two birds one stone", "two birds, one stone"],
                boldVariations: ["kill two birds with one stone", "two birds with one stone"]
            },
            // Day 12: Caught between a rock and a hard place
            {
                text: "caught between a rock and a hard place",
                meaning: "Faced with two equally difficult or unpleasant choices.",
                etymology: "One popular theory traces this to 1920s Arizona copper miners who had to choose between dangerous working conditions (the rock) or losing their jobs during a strike (the hard place). The phrase captures that feeling of having no good options.",
                examples: ["I'm caught between a rock and a hard place ‚Äî both choices are bad.", "There was no good option; she was caught between a rock and a hard place.", "He felt caught between a rock and a hard place after the argument."],
                words: ["caught", "between", "a", "rock", "and", "a", "hard", "place"],
                blanks: {answers: ["rock", "hard", "place"]},
                emoji: "ü™®",
                image: "idiom_images_pixel/idiom_14_caught_between_a_rock_and_a_hard_place_sora.mp4",
                hardModeAccepts: ["caught between a rock and a hard place", "caught between rock and hard place", "caught between a rock and hard place", "between a rock and a hard place", "catch between a rock and a hard place", "to be caught between a rock and a hard place", "between a rock and hard place", "rock and a hard place", "a rock and a hard place"]
            }
        ];

        // ==========================================
        // IDIOM SELECTION
        // ==========================================
        
        // Secret debug override: ?debug=H0m3r15mym8&day=5
        function getDebugDayOverride() {
            const params = new URLSearchParams(window.location.search);
            const debug = params.get('debug');
            const day = params.get('day');
            if (debug === 'H0m3r15mym8' && day) {
                const dayNum = parseInt(day);
                if (dayNum >= 1 && dayNum <= idiomLibrary.length) {
                    return dayNum;
                }
            }
            return null;
        }
        
        function getTodaysIdiomIndex() {
            const debugDay = getDebugDayOverride();
            if (debugDay !== null) {
                return debugDay - 1; // Day 1 = index 0
            }
            const dayNumber = getDaysSinceLaunch();
            return (dayNumber - 1) % idiomLibrary.length;
        }
        
        // Override day number for display if debug active
        function getDisplayDayNumber() {
            const debugDay = getDebugDayOverride();
            if (debugDay !== null) {
                return debugDay;
            }
            return getDaysSinceLaunch();
        }

        let currentIdiomIndex = getTodaysIdiomIndex();
        let idiom = idiomLibrary[currentIdiomIndex];

        // ==========================================
        // RENDER FUNCTION
        // ==========================================
        
        function render() {
            const app = document.getElementById('app');
            // Show archive day number if playing from archive, otherwise today's day
            const dayNumber = state.isPlayingArchive ? (state.archiveIdiomIndex + 1) : getDisplayDayNumber();
            const totalIdioms = getTotalIdioms();
            // Available idioms = current day number (day 1 = 1 available, day 12 = 12 available)
            const availableIdioms = Math.min(getDisplayDayNumber(), totalIdioms);
            
            // ==========================================
            // SCREEN: LANDING
            // ==========================================
            if (state.screen === 'landing') {
                // Debug mode bypasses "already played" state for testing
                const isDebugMode = getDebugDayOverride() !== null;
                const showReturnState = state.hasPlayedToday && !isDebugMode;
                
                if (showReturnState) {
                    // RETURN STATE - Already completed today
                    const hasTodayTrophy = hasIdiomTrophy(currentIdiomIndex);
                    app.innerHTML = `
                        ${hasTodayTrophy ? `<div class="completion-banner">üèÜ Day ${dayNumber} complete ‚Äì new idiom tomorrow!</div>` : ''}
                        
                        <div class="logo">
                            <span class="daily">DAILY</span>
                            <span class="idiom">IDIOM</span>
                            <div class="logo-game-badge">GAME</div>
                            
                        </div>
                        
                        <div class="stats-row-top">
                            <div class="stat-pill trophies">
                                <span class="icon">üèÜ</span>
                                <span>${state.trophies}/${availableIdioms}</span>
                            </div>
                            <div class="stat-pill xp">
                                <span class="icon">‚ö°</span>
                                <span>${state.totalXP}</span>
                            </div>
                        </div>
                        
                        <div class="video-container">
                            ${renderMedia(idiom)}
                        </div>
                        <div class="video-caption"><span class="day-badge">DAY ${dayNumber}</span> "${idiom.text}" ${hasTodayTrophy ? '‚úì' : ''}</div>
                        
                        ${hasTodayTrophy ? `
                            <button class="btn btn-primary" onclick="goToScreen('archive')" style="display: ${getDaysSinceLaunch() === 1 ? 'none' : 'block'};">üìö Play Past Idioms</button>
                            <div class="btn-row">
                                <button class="btn btn-secondary btn-half" onclick="startPractice()">üîÑ Practice</button>
                                <button class="btn btn-outline btn-half" onclick="shareResult()">üì§ Share</button>
                            </div>
                        ` : `
                            <button class="btn btn-primary" onclick="startPractice()">üîÑ Try Again</button>
                            <button class="btn btn-secondary" onclick="goToScreen('archive')" style="display: ${getDaysSinceLaunch() === 1 ? 'none' : 'block'};">üìö Play Past Idioms</button>
                        `}
                        
                        <div class="footer-legal">
                            <a href="terms.html">Terms of Service</a>
                            <a href="privacy.html">Privacy Policy</a>
                        </div>
                        <div class="footer-copyright">¬© 2026 Daily Idiom Game</div>
                    `;
                } else {
                    // FRESH LANDING - Not played today
                    app.innerHTML = `
                        <div class="logo">
                            <span class="daily">DAILY</span>
                            <span class="idiom">IDIOM</span>
                            <div class="logo-game-badge">GAME</div>
                            
                        </div>
                        
                        <div class="stats-row-top">
                            <div class="stat-pill trophies">
                                <span class="icon">üèÜ</span>
                                <span>${state.trophies}/${availableIdioms}</span>
                            </div>
                            <div class="stat-pill xp">
                                <span class="icon">‚ö°</span>
                                <span>${state.totalXP}</span>
                            </div>
                        </div>
                        
                        <div class="video-container">
                            ${renderMedia(idiom)}
                        </div>
                        <div class="video-caption"><span class="day-badge">DAY ${dayNumber}</span> Guess the idiom from the video!</div>
                        
                        <button class="btn btn-primary" onclick="goToScreen('difficulty')">‚ñ∂ Play</button>
                        
                        <div class="footer-legal">
                            <a href="terms.html">Terms of Service</a>
                            <a href="privacy.html">Privacy Policy</a>
                        </div>
                        <div class="footer-copyright">¬© 2026 Daily Idiom Game</div>
                    `;
                }
            }
            
            // ==========================================
            // SCREEN: DIFFICULTY SELECT
            // ==========================================
            else if (state.screen === 'difficulty') {
                app.innerHTML = `
                    <div class="video-container">
                        ${renderMedia(idiom)}
                    </div>
                    <div class="video-caption"><span class="day-badge">DAY ${dayNumber}</span></div>
                    
                    <div class="difficulty-title">Choose your challenge</div>
                    
                    <div class="difficulty-grid">
                        <div class="diff-btn" onclick="selectDifficulty('easy')">
                            <span class="stars">‚≠ê</span>
                            <span class="xp-reward">+10</span>
                            <span class="diff-desc">Reorder</span>
                        </div>
                        <div class="diff-btn" onclick="selectDifficulty('medium')">
                            <span class="stars">‚≠ê‚≠ê</span>
                            <span class="xp-reward">+50</span>
                            <span class="diff-desc">Fill in</span>
                        </div>
                        <div class="diff-btn" onclick="selectDifficulty('hard')">
                            <span class="stars">‚≠ê‚≠ê‚≠ê</span>
                            <span class="xp-reward">+100</span>
                            <span class="diff-desc">Type it</span>
                        </div>
                    </div>
                `;
            }
            
            // ==========================================
            // SCREEN: SOLVE (GAMEPLAY)
            // ==========================================
            else if (state.screen === 'solve') {
                let solveContent = '';
                const difficultyStars = state.difficulty === 'easy' ? '‚≠ê' : state.difficulty === 'medium' ? '‚≠ê‚≠ê' : '‚≠ê‚≠ê‚≠ê';
                const xpReward = XP_VALUES[state.difficulty];
                
                if (state.difficulty === 'easy') {
                    // Shuffle ONCE and store
                    if (!state.shuffledWords) {
                        let shuffled = [...idiom.words];
                        let attempts = 0;
                        do {
                            shuffled = [...idiom.words].sort(() => Math.random() - 0.5);
                            attempts++;
                        } while (shuffled.join(' ') === idiom.words.join(' ') && attempts < 10);
                        state.shuffledWords = shuffled;
                    }
                    
                    const shuffled = state.shuffledWords;
                    const usedIndices = state.usedWordIndices || [];
                    
                    solveContent = `
                        <div class="word-area">
                            ${state.selectedWords.length === 0 ? 
                                '<div style="color: #999; font-size: 14px;">Tap words below to build the idiom...</div>' :
                                state.selectedWords.map((w, i) => 
                                    `<div class="word-tile in-answer" onclick="removeWord(${i})">${w}</div>`
                                ).join('')
                            }
                        </div>
                        
                        <div class="word-tiles-container">
                            ${shuffled.map((word, index) => 
                                `<div class="word-tile ${usedIndices.includes(index) ? 'selected' : ''}" 
                                     onclick="addWordByIndex(${index}, '${word}')">
                                    ${word}
                                </div>`
                            ).join('')}
                        </div>
                    `;
                }
                
                else if (state.difficulty === 'medium') {
                    const blanksText = generateBlanksText();
                    solveContent = `
                        <div class="fill-blanks">
                            ${blanksText}
                        </div>
                    `;
                }
                
                else if (state.difficulty === 'hard') {
                    solveContent = `
                        <div class="input-group">
                            <label class="input-label">Type the complete idiom:</label>
                            <input type="text" class="text-input" id="userAnswer"
                                   value="${state.userAnswer}"
                                   oninput="updateAnswer(this.value)"
                                   placeholder="Enter the idiom..."
                                   autocomplete="off">
                        </div>
                    `;
                }
                
                app.innerHTML = `
                    <div class="mode-title">${difficultyStars} +${xpReward} XP</div>
                    
                    <div class="video-container" style="height: 200px;">
                        ${renderMedia(idiom)}
                    </div>
                    
                    ${solveContent}
                    
                    <button class="btn btn-primary" onclick="checkAnswer()">Check Answer</button>
                `;
            }
            
            // ==========================================
            // SCREEN: DELIGHT (First-guess celebration)
            // ==========================================
            else if (state.screen === 'delight') {
                const delight = getDelightScreen(getDisplayDayNumber());
                const confettiHTML = `
                    <div class="confetti square c1"></div>
                    <div class="confetti circle c2"></div>
                    <div class="confetti triangle c3"></div>
                    <div class="confetti square c4"></div>
                    <div class="confetti circle c5"></div>
                    <div class="confetti triangle c6"></div>
                    <div class="confetti square c2"></div>
                    <div class="confetti circle c1"></div>
                    <div class="confetti triangle c4"></div>
                    <div class="confetti square c5"></div>
                    <div class="confetti circle c3"></div>
                    <div class="confetti triangle c1"></div>
                    <div class="confetti square c6"></div>
                    <div class="confetti circle c4"></div>
                    <div class="confetti triangle c2"></div>
                `;
                
                app.innerHTML = `
                    <div class="delight-screen">
                        <div class="confetti-container">
                            ${confettiHTML}
                        </div>
                        
                        <div class="delight-video-area">
                            <div class="delight-video-inner">
                                <video id="delight-video" src="${delight.video}" autoplay loop muted playsinline webkit-playsinline style="width: 100%; height: 100%; object-fit: cover;"></video>
                            </div>
                        </div>
                        
                        <div class="delight-title-area">
                            <span class="title-stars">‚≠ê</span>
                            <div class="delight-title">${delight.title}</div>
                            <span class="title-stars">‚≠ê</span>
                        </div>
                        
                        <div class="delight-continue-btn" onclick="goToScreen('complete')">Continue ‚Üí</div>
                    </div>
                `;
                
                // Force play for mobile
                const delightVid = document.getElementById('delight-video');
                if (delightVid) {
                    delightVid.play().catch(e => console.log('Delight video autoplay blocked:', e));
                }
            }
            
            // ==========================================
            // SCREEN: ANSWER REVEAL
            // ==========================================
            else if (state.screen === 'answer') {
                const isCorrect = state.isCorrect;
                const activeTab = state.activeTab || 'meaning';
                
                let tabContent = '';
                if (activeTab === 'meaning') {
                    tabContent = `<p>${idiom.meaning}</p>`;
                } else if (activeTab === 'useit') {
                    // Bold the idiom text and variations in examples
                    const variations = idiom.boldVariations || [idiom.text];
                    tabContent = idiom.examples.map(ex => {
                        let boldedEx = ex;
                        variations.forEach(v => {
                            boldedEx = boldedEx.replace(new RegExp(v, 'gi'), `<strong>$&</strong>`);
                        });
                        return `<p style="margin-bottom: 10px;">‚Ä¢ ${boldedEx}</p>`;
                    }).join('');
                } else if (activeTab === 'origin') {
                    tabContent = `<p>${idiom.etymology}</p>`;
                }
                
                app.innerHTML = `
                    <div class="answer-title ${isCorrect ? 'correct' : 'incorrect'}">
                        ${isCorrect ? 'CORRECT!' : 'NOT QUITE!'}
                    </div>
                    
                    <div class="idiom-display">"${idiom.text}"</div>
                    
                    <div class="info-tabs">
                        <button class="info-tab ${activeTab === 'meaning' ? 'active' : ''}" onclick="setTab('meaning')">Meaning</button>
                        <button class="info-tab ${activeTab === 'useit' ? 'active' : ''}" onclick="setTab('useit')">Use it</button>
                        <button class="info-tab ${activeTab === 'origin' ? 'active' : ''}" onclick="setTab('origin')">Origin</button>
                    </div>
                    
                    <div class="info-content">
                        ${tabContent}
                    </div>
                    
                    <button class="btn btn-primary" onclick="goToNextFromAnswer()">Next ‚Üí</button>
                `;
            }
            
            // ==========================================
            // SCREEN: COMPLETE
            // ==========================================
            else if (state.screen === 'complete') {
                const hasTrophy = hasIdiomTrophy(currentIdiomIndex);
                const isToday = !state.isPlayingArchive;
                const todayDayNum = getDaysSinceLaunch();
                
                app.innerHTML = `
                    ${hasTrophy && isToday ? `<div class="completion-banner">üèÜ Day ${todayDayNum} complete ‚Äì new idiom tomorrow!</div>` : ''}
                    
                    <div class="logo">
                        <span class="daily">DAILY</span>
                        <span class="idiom">IDIOM</span>
                        <div class="logo-game-badge">GAME</div>
                    </div>
                    
                    <div class="stats-row-top">
                        <div class="stat-pill trophies">
                            <span class="icon">üèÜ</span>
                            <span>${state.trophies}/${availableIdioms}</span>
                        </div>
                        <div class="stat-pill xp">
                            <span class="icon">‚ö°</span>
                            <span>${state.totalXP}</span>
                        </div>
                    </div>
                    
                    <div class="video-container">
                        ${renderMedia(idiom)}
                    </div>
                    <div class="video-caption"><span class="day-badge">DAY ${dayNumber}</span> "${idiom.text}" ${hasTrophy ? '‚úì' : ''}</div>
                    
                    ${hasTrophy ? `
                        <button class="btn btn-primary" onclick="goToScreen('archive')" style="display: ${getDaysSinceLaunch() === 1 ? 'none' : 'block'};">üìö Play Past Idioms</button>
                        <div class="btn-row">
                            <button class="btn btn-secondary btn-half" onclick="startPractice()">üîÑ Practice</button>
                            <button class="btn btn-outline btn-half" onclick="shareResult()">üì§ Share</button>
                        </div>
                    ` : `
                        <button class="btn btn-primary" onclick="startPractice()">üîÑ Try Again</button>
                        <button class="btn btn-secondary" onclick="goToScreen('archive')" style="display: ${getDaysSinceLaunch() === 1 ? 'none' : 'block'};">üìö Play Past Idioms</button>
                    `}
                `;
            }
            
            // ==========================================
            // SCREEN: ARCHIVE
            // ==========================================
            else if (state.screen === 'archive') {
                const todayDayNumber = getDisplayDayNumber();
                const availableCount = todayDayNumber === 1 ? 0 : Math.min(todayDayNumber - 1, idiomLibrary.length);
                
                let archiveItems = '';
                for (let i = 0; i < availableCount; i++) {
                    const item = idiomLibrary[i];
                    const hasTrophy = hasIdiomTrophy(i);
                    
                    archiveItems += `
                        <div class="archive-item" onclick="playArchiveIdiom(${i})">
                            <div>
                                <span class="day-badge">DAY ${i + 1}</span>
                                <span style="color: var(--navy);">${hasTrophy ? `"${item.text}"` : '???'}</span>
                            </div>
                            <span class="archive-status">${hasTrophy ? 'üèÜ' : '‚ñ∂Ô∏è'}</span>
                        </div>
                    `;
                }
                
                app.innerHTML = `
                    <button class="back-btn" onclick="goToScreen('landing')">‚Üê Home</button>
                    
                    <div style="text-align: center; margin-bottom: 16px;">
                        <div style="font-family: 'Press Start 2P', cursive; font-size: 14px; color: var(--navy);">üìö ARCHIVE</div>
                        <div style="font-size: 13px; color: var(--text-muted); margin-top: 6px;">üèÜ ${state.trophies}/${availableIdioms} trophies collected</div>
                    </div>
                    
                    <div style="max-height: 350px; overflow-y: auto;">
                        ${archiveItems || '<div style="text-align: center; color: #999; padding: 40px;">No past idioms yet.<br>Come back tomorrow!</div>'}
                    </div>
                `;
            }
            
            // ==========================================
            // SCREEN: TRANSLATE
            // ==========================================
            else if (state.screen === 'translate') {
                const selectedLang = state.selectedLanguage || 'es';
                
                app.innerHTML = `
                    <button class="back-btn" onclick="goToScreen('answer')">‚Üê Back</button>
                    
                    <div class="idiom-display">"${idiom.text}"</div>
                    
                    <div style="background: #fff3cd; padding: 12px; border-radius: 10px; margin-bottom: 20px; font-size: 13px; color: #856404;">
                        ‚ö†Ô∏è Translations coming soon!
                    </div>
                    
                    <div class="input-group">
                        <label class="input-label">Select Language:</label>
                        <select class="text-input" onchange="changeLanguage(this.value)" style="cursor: pointer;">
                            <option value="es" ${selectedLang === 'es' ? 'selected' : ''}>üá™üá∏ Spanish</option>
                            <option value="fr" ${selectedLang === 'fr' ? 'selected' : ''}>üá´üá∑ French</option>
                            <option value="de" ${selectedLang === 'de' ? 'selected' : ''}>üá©üá™ German</option>
                            <option value="zh-CN" ${selectedLang === 'zh-CN' ? 'selected' : ''}>üá®üá≥ Chinese</option>
                            <option value="ja" ${selectedLang === 'ja' ? 'selected' : ''}>üáØüáµ Japanese</option>
                        </select>
                    </div>
                    
                    <div class="info-content">
                        <p><strong>Meaning:</strong><br>${idiom.meaning}</p>
                        <p style="margin-top: 15px; font-size: 12px; color: #999; font-style: italic;">
                            (Full translations coming soon)
                        </p>
                    </div>
                    
                    <button class="btn btn-primary" onclick="goToScreen('answer')">Continue</button>
                `;
            }
        }

        // ==========================================
        // HELPER FUNCTIONS
        // ==========================================
        
        function renderMedia(idiom) {
            if (idiom.image) {
                if (idiom.image.endsWith('.mp4')) {
                    return `<div class="video-inner"><video src="${idiom.image}" autoplay loop muted playsinline style="width: 100%; height: 100%; object-fit: cover;"></video></div>`;
                } else {
                    return `<div class="video-inner"><img src="${idiom.image}" alt="${idiom.text}" style="width: 100%; height: 100%; object-fit: cover;"></div>`;
                }
            }
            return `<div class="video-inner"><div class="emoji-placeholder">${idiom.emoji}</div></div>`;
        }

        // Check if idiom has trophy
        function hasIdiomTrophy(index) {
            return localStorage.getItem(`trophy_${index}`) === 'true';
        }
        
        function capitalizeFirst(str) {
            return str.charAt(0).toUpperCase() + str.slice(1);
        }
        
        function isIdiomCompleted(index) {
            // Check localStorage for completed idioms
            const completed = JSON.parse(localStorage.getItem('completedIdioms') || '[]');
            return completed.includes(index);
        }
        
        function markIdiomCompleted(index) {
            const completed = JSON.parse(localStorage.getItem('completedIdioms') || '[]');
            if (!completed.includes(index)) {
                completed.push(index);
                localStorage.setItem('completedIdioms', JSON.stringify(completed));
            }
        }
        
        function generateBlanksText() {
            const words = idiom.text.split(' ');
            const answers = idiom.blanks.answers;
            let blankIndex = 0;
            
            return words.map(word => {
                if (answers.includes(word)) {
                    blankIndex++;
                    return `<input type="text" class="blank-input" id="blank${blankIndex}" 
                                   value="${state['blank' + blankIndex] || ''}" 
                                   oninput="updateBlank('blank${blankIndex}', this.value)"
                                   placeholder="?" autocomplete="off">`;
                }
                return word;
            }).join(' ');
        }

        // ==========================================
        // GAME ACTIONS
        // ==========================================
        
        function goToScreen(screen) {
            // Track archive visits
            if (screen === 'archive') {
                trackEvent('archive_visited');
            }
            // When going back to landing, reset to today's idiom
            if (screen === 'landing') {
                state.isPlayingArchive = false;
                state.archiveIdiomIndex = null;
                currentIdiomIndex = getTodaysIdiomIndex();
                idiom = idiomLibrary[currentIdiomIndex];
            }
            state.screen = screen;
            render();
        }
        
        function setTab(tab) {
            state.activeTab = tab;
            render();
        }
        
        function goToNextFromAnswer() {
            // If qualified for delight, show it; otherwise go to complete
            if (state.showDelight) {
                state.screen = 'delight';
            } else {
                state.screen = 'complete';
            }
            render();
        }
        
        function selectDifficulty(level) {
            trackEvent('difficulty_selected', { difficulty: level });
            state.difficulty = level;
            state.shuffledWords = null; // Reset for new game
            state.selectedWords = [];
            state.usedWordIndices = [];
            state.screen = 'solve';
            render();
        }
        
        function addWordByIndex(index, word) {
            if (!state.usedWordIndices.includes(index)) {
                state.selectedWords.push(word);
                state.usedWordIndices.push(index);
                render();
            }
        }
        
        function removeWord(selectedIndex) {
            state.selectedWords.splice(selectedIndex, 1);
            state.usedWordIndices.splice(selectedIndex, 1);
            render();
        }
        
        function updateBlank(field, value) {
            state[field] = value;
        }
        
        function updateAnswer(value) {
            state.userAnswer = value;
        }
        
        function checkAnswer() {
            let correct = false;
            
            if (state.difficulty === 'easy') {
                const userPhrase = state.selectedWords.join(' ').toLowerCase();
                correct = userPhrase === idiom.text;
            } else if (state.difficulty === 'medium') {
                const answers = idiom.blanks.answers;
                correct = answers.every((answer, index) => {
                    const blankValue = state['blank' + (index + 1)];
                    return blankValue && blankValue.toLowerCase().trim() === answer.toLowerCase();
                });
            } else if (state.difficulty === 'hard') {
                // Normalise user answer: lowercase, trim, strip punctuation
                let userAnswer = state.userAnswer.toLowerCase().trim()
                    .replace(/[.,!?;:'"-]/g, '')  // Remove punctuation
                    .replace(/^to\s+/, '');        // Remove leading "to "
                
                correct = (idiom.hardModeAccepts || [idiom.text]).some(accept => {
                    let normalised = accept.toLowerCase().trim()
                        .replace(/[.,!?;:'"-]/g, '')
                        .replace(/^to\s+/, '');
                    return normalised === userAnswer;
                });
            }
            
            state.isCorrect = correct;
            
            // Check if this qualifies for delight screen:
            // - Correct answer
            // - First attempt today
            // - Not playing archive
            // - Not already played today
            const qualifiesForDelight = correct && state.isFirstAttempt && !state.isPlayingArchive && !state.hasPlayedToday;
            state.showDelight = qualifiesForDelight;
            
            // After first attempt, mark it as no longer first
            state.isFirstAttempt = false;
            
            // In debug mode, don't save progress (allows testing all idioms freely)
            const isDebugMode = getDebugDayOverride() !== null;
            
            if (!isDebugMode) {
                // Always mark the idiom as completed (for day tracking)
                markIdiomCompleted(currentIdiomIndex);
                
                // Award trophy and XP only if correct (first time only for this idiom)
                if (correct) {
                    // Check if this idiom hasn't already earned a trophy
                    const trophyKey = `trophy_${currentIdiomIndex}`;
                    if (!localStorage.getItem(trophyKey)) {
                        state.trophies++;
                        state.totalXP += XP_VALUES[state.difficulty];
                        localStorage.setItem(trophyKey, 'true');
                        saveProgress();
                    }
                }
                
                if (!state.hasPlayedToday && !state.isPlayingArchive) {
                    markTodayComplete();
                }
            }
            
            state.activeTab = 'meaning';
            // Always go to answer screen first - delight comes after if qualified
            state.screen = 'answer';
            trackEvent('game_completed', { 
                difficulty: state.difficulty, 
                result: correct ? 'correct' : 'incorrect',
                day: getDisplayDayNumber(),
                first_attempt: qualifiesForDelight
            });
            render();
        }
        
        function startPractice() {
            trackEvent('game_started', { day: getDisplayDayNumber() });
            state.screen = 'difficulty';
            state.difficulty = null;
            state.selectedWords = [];
            state.usedWordIndices = [];
            state.shuffledWords = null;
            state.userAnswer = '';
            state.blank1 = '';
            state.blank2 = '';
            state.blank3 = '';
            render();
        }
        
        function playArchiveIdiom(index) {
            currentIdiomIndex = index;
            idiom = idiomLibrary[index];
            state.isPlayingArchive = true;
            state.archiveIdiomIndex = index;
            state.screen = 'difficulty';
            state.difficulty = null;
            state.selectedWords = [];
            state.usedWordIndices = [];
            state.shuffledWords = null;
            state.userAnswer = '';
            state.blank1 = '';
            state.blank2 = '';
            state.blank3 = '';
            render();
        }
        
        function changeLanguage(lang) {
            state.selectedLanguage = lang;
            render();
        }

        // ==========================================
        // SHARING
        // ==========================================
        
        async function shareResult() {
            trackEvent('share_clicked', { difficulty: state.difficulty });
            const difficultyStars = state.difficulty === 'easy' ? '‚≠ê' : state.difficulty === 'medium' ? '‚≠ê‚≠ê' : '‚≠ê‚≠ê‚≠ê';
            
            const text = `I solved today's Daily Idiom! üéâ

${difficultyStars} Day ${getDisplayDayNumber()}
üèÜ ${state.trophies}/${getTotalIdioms()} trophies
‚ö° ${state.totalXP} XP

Can you solve it?
https://dailyidiom.com

@dailyidiomgame`;

            if (navigator.share) {
                try {
                    await navigator.share({
                        text: text,
                        url: 'https://dailyidiom.com'
                    });
                    return;
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        console.log('Share failed, falling back to clipboard');
                    }
                }
            }
            
            try {
                await navigator.clipboard.writeText(text);
                showToast('üìã Copied to clipboard!');
            } catch (err) {
                showToast('Unable to share');
            }
        }
        
        function showToast(message) {
            const toast = document.createElement('div');
            toast.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: var(--green);
                color: white;
                padding: 15px 25px;
                border-radius: 12px;
                font-family: 'Nunito', sans-serif;
                font-weight: 700;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                z-index: 9999;
                animation: slideIn 0.3s ease;
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // ==========================================
        // INITIALIZE
        // ==========================================
        
        window.onload = () => {
            render();
            preloadDelightVideo();
        };
    </script>
</body>
</html>
